//booking.service.ts

import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class BookingService {
  private baseUrl = 'http://localhost:8080/bookings';

  constructor(private http: HttpClient) {}

  createBooking(userId: number, packageId: number, startDate: string): Observable<any> {
    return this.http.post(`${this.baseUrl}`, {
      userId,
      packageId,
      startDate
    });
  }
}


//booking.component.ts

import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { BookingService } from 'src/app/services/booking.service';

@Component({
  selector: 'app-booking',
  templateUrl: './booking.component.html'
})
export class BookingComponent implements OnInit {
  packageId!: number;
  userId = 101; // Normally taken from login/session
  startDate = '';

  constructor(
    private bookingService: BookingService,
    private route: ActivatedRoute,
    private router: Router
  ) {}

  ngOnInit(): void {
    this.packageId = +this.route.snapshot.paramMap.get('packageId')!;
  }

  bookNow() {
    if (!this.startDate) {
      alert('Please select a start date.');
      return;
    }

    this.bookingService
      .createBooking(this.userId, this.packageId, this.startDate)
      .subscribe({
        next: (res) => {
          alert('Booking Successful!');
          this.router.navigate(['/payment', res.bookingId]);
        },
        error: () => {
          alert('Booking failed!');
        }
      });
  }
}


//booking.component.html
<div class="container mt-5">
  <h2>Book Your Package</h2>
  <p>Package ID: {{ packageId }}</p>

  <form (ngSubmit)="bookNow()">
    <div class="mb-3">
      <label for="startDate" class="form-label">Select Start Date:</label>
      <input
        type="date"
        id="startDate"
        class="form-control"
        [(ngModel)]="startDate"
        name="startDate"
        required
      />
    </div>

    <button type="submit" class="btn btn-primary">Book Now</button>
  </form>
</div>



//payment.component.ts
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { PaymentService } from 'src/app/services/payment.service';

@Component({
  selector: 'app-payment',
  templateUrl: './payment.component.html'
})
export class PaymentComponent implements OnInit {
  bookingId!: number;
  userId = 101; // Normally from auth
  paymentMethod = 'CREDIT_CARD';
  amount = 0;

  constructor(
    private route: ActivatedRoute,
    private router: Router,
    private paymentService: PaymentService
  ) {}

  ngOnInit(): void {
    this.bookingId = +this.route.snapshot.paramMap.get('bookingId')!;
    // You can fetch booking details here to get dynamic amount
    this.amount = 34999; // Static for now, or load from API
  }

  payNow() {
    const payment = {
      bookingId: this.bookingId,
      userId: this.userId,
      amount: this.amount,
      paymentMethod: this.paymentMethod
    };

    this.paymentService.makePayment(payment).subscribe({
      next: () => {
        alert('Payment Successful!');
        this.router.navigate(['/confirmation', this.bookingId]);
      },
      error: () => {
        alert('Payment failed!');
      }
    });
  }
}


//payment.component.html
<div class="container mt-5">
  <h2>Payment</h2>
  <p>Booking ID: {{ bookingId }}</p>

  <form (ngSubmit)="payNow()">
    <div class="mb-3">
      <label for="amount" class="form-label">Amount:</label>
      <input type="text" class="form-control" id="amount" [(ngModel)]="amount" name="amount" readonly />
    </div>

    <div class="mb-3">
      <label for="method" class="form-label">Payment Method:</label>
      <select class="form-select" id="method" [(ngModel)]="paymentMethod" name="paymentMethod">
        <option value="CREDIT_CARD">Credit Card</option>
        <option value="DEBIT_CARD">Debit Card</option>
        <option value="NET_BANKING">Net Banking</option>
        <option value="UPI">UPI</option>
      </select>
    </div>

    <button type="submit" class="btn btn-success">Make Payment</button>
  </form>
</div>


//payment.service.ts
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class PaymentService {
  private baseUrl = 'http://localhost:8080/payments';

  constructor(private http: HttpClient) {}

  makePayment(payment: any): Observable<any> {
    return this.http.post(`${this.baseUrl}`, payment);
  }
}


//confirmation.component.ts
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';

@Component({
  selector: 'app-confirmation',
  templateUrl: './confirmation.component.html'
})
export class ConfirmationComponent implements OnInit {
  bookingId!: number;

  ngOnInit(): void {
    this.bookingId = +this.route.snapshot.paramMap.get('bookingId')!;
  }
}

//confirmation.component.html
<div class="container mt-5 text-center">
  <h2>ðŸŽ‰ Booking Confirmed!</h2>
  <p>Your booking (ID: <strong>{{ bookingId }}</strong>) has been confirmed.</p>
  <p>You will receive a confirmation email shortly.</p>

  <a routerLink="/" class="btn btn-primary mt-3">Go to Dashboard</a>
</div>

